<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn how to integrate with HashiCorp Vault and retrieve Vault tokens for tasks.">

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon-d0ced218.png">
    <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-194x194-bb8de46a.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/assets/images/favicons/android-chrome-192x192-9f336178.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32-10aa6ba6.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16-330a0dd1.png" sizes="16x16">
    <link rel="manifest" href="/android-manifest.json">
    <link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab-479e3179.svg" color="#25BA81">
    <meta name="apple-mobile-web-app-title" content="HashiCorp Nomad">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="application-name" content="HashiCorp Nomad">
    <meta name="msapplication-config" content="/microsoft-tile.xml" />
    <meta name="msapplication-TileColor" content="#25BA81">
    <meta name="msapplication-TileImage" content="/assets/images/favicons/mstile-144x144-7f37eaf2.png">
    <meta name="theme-color" content="#ffffff">

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@HashiCorp" />
    <meta name="twitter:creator" content="@HashiCorp" />
    <meta property="og:url" content="https://www.nomadproject.io/docs/vault-integration/index.html" />
    <meta property="og:title" content="Vault Integration - Nomad by HashiCorp" />
    <meta property="og:site_name" content="Nomad by HashiCorp"/>
    <meta property="og:image" content="https://www.nomadproject.io/assets/images/og-image-e0e8d18d.png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="1200"/>
    <meta property="og:description" content="Learn how to integrate with HashiCorp Vault and retrieve Vault tokens for tasks." />

    <title>Vault Integration - Nomad by HashiCorp</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://use.typekit.net/wxf7mfi.css">
    <link href="/assets/stylesheets/application-b44b5029.css" rel="stylesheet" />

    <!-- Site scripts -->
    <!--[if lt IE 9]><script src="/assets/javascripts/ie-compat-c141a02d.js" defer="defer"></script><![endif]-->
    <script src="/assets/javascripts/application-4af6ff56.js" defer="defer"></script>

    <!-- Analytics scrpts -->
    <script defer>
      !function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],e.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),e.push(a),e}};for(var t=0;t<e.methods.length;t++){var a=e.methods[t];e[a]=e.factory(a)}e.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+e+"/analytics.min.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a)},e.SNIPPET_VERSION="4.0.0",e.load("qW11yxgipKMsKFKQUCpTVgQUYftYsJj0")}}();var om597a24292a958,om597a24292a958_poll=function(){var e=0;return function(t,a){clearInterval(e),e=setInterval(t,a)}}();!function(e,t,a){if(e.getElementById(a))om597a24292a958_poll(function(){if(window.om_loaded&&!om597a24292a958)return(om597a24292a958=new OptinMonsterApp).init({s:"35109.597a24292a958",staging:0,dev:0,beta:0})},25);else{var n=!1,o=e.createElement("script");o.id=a,o.src="//a.optnmstr.com/app/js/api.min.js",o.async=!0,o.onload=o.onreadystatechange=function(){if(!(n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState))try{n=om_loaded=!0,(om597a24292a958=new OptinMonsterApp).init({s:"35109.597a24292a958",staging:0,dev:0,beta:0}),o.onload=o.onreadystatechange=null}catch(e){}},(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(o)}}(document,0,"omapi-script");
    </script>

    
  </head>

  <body id="page-docs-vault-integration" class="layout-docs page-vault-integration">

    <svg class="hidden-print" aria-hidden="true" style="position: absolute; width: 0; height: 0;" width="0" height="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
    <symbol id="mega-nav-icon-angle" viewBox="0 0 13 7">
      <polygon points="6.5,6.5 0.7,1.6 1.3,0.8 6.5,5.2 11.7,0.8 12.3,1.6 "/>
    </symbol>
    <symbol id="mega-nav-icon-close" viewBox="0 0 13 15">
      <path vector-effect="non-scaling-stroke" d="M1.1 14L11.9 1M11.9 14L1.1 1"/>
    </symbol>
  </defs>
</svg>
<div class="hidden-print mega-nav-sandbox">
  <div class="mega-nav-banner">
    <div class="container">
      <div class="mega-nav-banner-item">
        <a class="mega-nav-banner-logo" href="https://www.hashicorp.com"><img src="/assets/images/mega-nav/logo-hashicorp-wordmark-bbed0e8a.svg" alt="HashiCorp Logo" /></a>
      </div>
      <div class="mega-nav-banner-item">
        <p class="mega-nav-tagline"><span class="visible-xs text-muted">Learn the</span><span class="hidden-xs text-muted">Learn how Nomad fits into the</span></p>
        <div id="#mega-nav" class="mega-nav">
          <button type="button" id="mega-nav-ctrl" class="mega-nav-ctrl">
            <div class="mega-nav-ctrl-items">
              <img src="/assets/images/mega-nav/logo-hashicorp-a66fda95.svg" alt="HashiCorp Logo" />
              <strong>HashiCorp Suite</strong>
              <span class="mega-nav-icon-outline">
                <svg class="mega-nav-icon mega-nav-icon-angle-right" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#mega-nav-icon-angle"></use></svg><span class="visuallyhidden">Open</span>
              </span>
            </div>
          </button>
          <div id="mega-nav-body-ct" class="mega-nav-body-ct" aria-labelledby="mega-nav-ctrl">
            <div class="mega-nav-body">
              <button type="button" id="mega-nav-close" class="mega-nav-close"><svg class="mega-nav-icon mega-nav-icon-close" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#mega-nav-icon-close"></use></svg><span class="visuallyhidden">Close</span></button>
              <div class="mega-nav-body-header">
                <div class="mega-nav-body-header-item">
                  <h2 class="mega-nav-h1">Provision, Secure, Connect, and&nbsp;Run</h2>
                  <p class="mega-nav-h2">Any infrastructure for any&nbsp;application</p>
                </div>
                <div class="mega-nav-body-header-item">
                  <a href="https://www.hashicorp.com/" class="mega-nav-btn"><img src="/assets/images/mega-nav/logo-hashicorp-a66fda95.svg" alt="HashiCorp Logo" /> Learn the HashiCorp Enterprise&nbsp;Suite <svg class="mega-nav-icon mega-nav-icon-angle-right" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#mega-nav-icon-angle"></use></svg></a>
                </div>
              </div>
              <div class="mega-nav-body-grid">
                <div class="mega-nav-body-grid-item">
                  <h3 class="mega-nav-h3">Provision</h3>
                  <ul class="mega-nav-grid">
                    <li>
                      <a href="https://www.vagrantup.com" class="mega-nav-grid-item mega-nav-grid-item-vagrant">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-vagrant-a7ab5898.svg" alt="Vagrant Logo" />
                        </div>
                        <b>Vagrant</b>
                        <ul>
                          <li><span class="mega-nav-tag">Build</span></li>
                          <li><span class="mega-nav-tag">Test</span></li>
                        </ul>
                      </a>
                    </li>
                    <li>
                      <a href="https://www.packer.io" class="mega-nav-grid-item mega-nav-grid-item-packer">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-packer-cb3b9b94.svg" alt="Packer Logo" />
                        </div>
                        <b>Packer</b>
                        <ul>
                          <li><span class="mega-nav-tag">Package</span></li>
                        </ul>
                      </a>
                    </li>
                    <li>
                      <a href="https://www.terraform.io" class="mega-nav-grid-item mega-nav-grid-item-terraform">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-terraform-ff69eaae.svg" alt="Terraform Logo" />
                        </div>
                        <b>Terraform</b>
                        <ul>
                          <li><span class="mega-nav-tag">Provision</span></li>
                        </ul>
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="mega-nav-body-grid-item">
                  <h3 class="mega-nav-h3">Secure</h3>
                  <ul class="mega-nav-grid">
                    <li>
                      <a href="https://www.vaultproject.io" class="mega-nav-grid-item mega-nav-grid-item-vault">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-vault-0f83e3d2.svg" alt="Vault Logo" />
                        </div>
                        <b>Vault</b>
                        <ul>
                          <li><span class="mega-nav-tag">Secure</span></li>
                        </ul>
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="mega-nav-body-grid-item">
                  <h3 class="mega-nav-h3">Connect</h3>
                  <ul class="mega-nav-grid">
                    <li>
                      <a href="https://www.consul.io" class="mega-nav-grid-item mega-nav-grid-item-consul">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-consul-c77f6844.svg" alt="Consul Logo" />
                        </div>
                        <b>Consul</b>
                        <ul>
                          <li><span class="mega-nav-tag">Connect</span></li>
                        </ul>
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="mega-nav-body-grid-item">
                  <h3 class="mega-nav-h3">Run</h3>
                  <ul class="mega-nav-grid">
                    <li>
                      <a href="https://www.nomadproject.io" class="mega-nav-grid-item mega-nav-grid-item-nomad">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-nomad-c4c148be.svg" alt="Nomad Logo" />
                        </div>
                        <b>Nomad</b>
                        <ul>
                          <li><span class="mega-nav-tag">Run</span></li>
                        </ul>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="mega-nav-body-footer">
                <p>Seven elements of the modern Application Lifecycle</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


    <div id="header" class="navigation navbar-static-top hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <div class="navbar-header">
              <div class="navbar-brand">
                <a href="/">
                  <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 207 60" class="logo" height="50">
  <g fill="none">
    <path class="top" fill="#25BA81" d="M26.03.01L0 15.05l17.56 10.32 3.56-2.17 8.63 4.82v-10l8.27-4.97v10.02l14.48-8.02v-.04"></path>
    <path class="left" fill="#25BA81" d="M22.75 32.03v9.99l-7.88 5v-20l2.99-1.83L.15 15.05H0v29.96l26.25 15V34.03"></path>
    <path class="right" fill="#1F9967" d="M38.02 23.07v9.95l-6.93 4.01-4.84-3v25.98h.14l26.11-15V15.05l-.49-.01"></path>
    <path class="text" fill="#000" d="M78.49 21.83v24.24h-5.9v-32h8.06l12.14 24.32V14.1h5.9v32h-8.06m22.46.45c-8 0-10.18-4.42-10.18-9.22v-5.9c0-4.8 2.16-9.22 10.18-9.22s10.18 4.42 10.18 9.22v5.91c0 4.79-2.16 9.21-10.18 9.21zm0-19.35c-3.12 0-4.32 1.39-4.32 4v6.29c0 2.64 1.2 4 4.32 4s4.32-1.39 4.32-4v-6.25c0-2.64-1.2-4.04-4.32-4.04zm27.99 18.87V29.75c0-1.25-.53-1.87-1.87-1.87-2.147.252-4.22.932-6.1 2v16.19h-5.86V22.69h4.46l.58 2c2.916-1.46 6.104-2.293 9.36-2.45 1.852-.175 3.616.823 4.42 2.5 2.922-1.495 6.13-2.348 9.41-2.5 3.89 0 5.28 2.74 5.28 6.91v16.92h-5.86V29.75c0-1.25-.53-1.87-1.87-1.87-2.15.234-4.23.915-6.1 2v16.19h-5.85zm41.81 0h-4.8l-.43-1.58c-2.084 1.352-4.516 2.068-7 2.06-4.27 0-6.1-2.93-6.1-7 0-4.75 2.06-6.58 6.82-6.58H177v-2.41c0-2.59-.72-3.5-4.46-3.5-2.18.024-4.35.265-6.48.72l-.72-4.46c2.606-.72 5.296-1.09 8-1.1 7.34 0 9.5 2.59 9.5 8.45l.05 15.4zM177 37.24h-4.32c-1.92 0-2.45.53-2.45 2.3 0 1.77.53 2.35 2.35 2.35 1.55-.02 3.07-.434 4.42-1.2v-3.45zm9.48-6.77c0-5.18 2.3-8.26 7.73-8.26 2.097.02 4.187.244 6.24.67v-9.74l5.86-.82v33.75h-4.66l-.58-2c-2.133 1.595-4.726 2.454-7.39 2.45-4.7 0-7.2-2.79-7.2-8.11v-7.94zm14-2.64c-1.702-.38-3.437-.588-5.18-.62-2.11 0-2.93 1-2.93 3.12v8.26c0 1.92.72 3 2.88 3 1.937-.07 3.787-.816 5.23-2.11V27.83z"></path>
  </g>
</svg>

                </a>
              </div>
              <button class="navbar-toggle" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="buttons hidden-xs">
              <nav class="navigation-links" role="navigation">
                <ul class="main-links nav navbar-nav navbar-right">
                  <li><a href="/intro/index.html">Intro</a></li>
                  <li><a href="/guides/index.html">Guides</a></li>
                  <li><a href="/docs/index.html">Docs</a></li>
                  <li><a href="/api/index.html">API</a></li>
                  <li><a href="/resources.html">Resources</a></li>
                  <li><a href="https://www.hashicorp.com/products/nomad/?utm_source=oss&utm_medium=header-nav&utm_campaign=nomad">Enterprise</a></li>
                  <li><a href="https://demo.nomadproject.io">UI Demo</a></li>
                  <li>
                    <a href="/downloads.html">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 28 28" enable-background="new 0 0 28 28" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
  <path d="M28 0H0v28h28V0zM13.8 22.9L7 17.3l2-2.4 3.2 2.6V7h3.2v10.5l3.2-2.6 2 2.4L13.8 22.9z"></path>
</svg>
 Download
                    </a>
                  </li>
                  <li>
                    <a href="https://github.com/hashicorp/nomad">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 28 28" enable-background="new 0 0 28 28" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
  <path d="M28 0H0v28h11.4c0 0 0-1.3 0-2.4C7.7 26.4 7 23.9 7 23.9 6.4 22.4 5.5 22 5.5 22c-1.2-0.8 0.1-0.8 0.1-0.8 1.3 0.1 2 1.4 2 1.4 1.2 2 3 1.4 3.8 1.1 0.1-0.8 0.5-1.4 0.9-1.8 -2.9-0.3-6-1.5-6-6.5 0-1.4 0.5-2.6 1.3-3.5C7.5 11.5 7 10.2 7.8 8.4c0 0 1.1-0.4 3.6 1.3 1-0.3 2.2-0.4 3.3-0.4 1.1 0 2.2 0.2 3.3 0.4 2.5-1.7 3.6-1.3 3.6-1.3 0.7 1.8 0.3 3.1 0.1 3.5 0.8 0.9 1.3 2.1 1.3 3.5 0 5-3.1 6.1-6 6.5 0.5 0.4 0.9 1.2 0.9 2.4 0 1.8 0 3.7 0 3.7H28V0z"></path>
</svg>
 GitHub
                    </a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar-overlay"></div>

<aside class="sidebar" role="navigation">
  <div class="sidebar-header">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 207 60" height="42">
  <g fill="none">
    <path class="top" fill="#25BA81" d="M26.03.01L0 15.05l17.56 10.32 3.56-2.17 8.63 4.82v-10l8.27-4.97v10.02l14.48-8.02v-.04"></path>
    <path class="left" fill="#25BA81" d="M22.75 32.03v9.99l-7.88 5v-20l2.99-1.83L.15 15.05H0v29.96l26.25 15V34.03"></path>
    <path class="right" fill="#1F9967" d="M38.02 23.07v9.95l-6.93 4.01-4.84-3v25.98h.14l26.11-15V15.05l-.49-.01"></path>
    <path class="text" fill="#000" d="M78.49 21.83v24.24h-5.9v-32h8.06l12.14 24.32V14.1h5.9v32h-8.06m22.46.45c-8 0-10.18-4.42-10.18-9.22v-5.9c0-4.8 2.16-9.22 10.18-9.22s10.18 4.42 10.18 9.22v5.91c0 4.79-2.16 9.21-10.18 9.21zm0-19.35c-3.12 0-4.32 1.39-4.32 4v6.29c0 2.64 1.2 4 4.32 4s4.32-1.39 4.32-4v-6.25c0-2.64-1.2-4.04-4.32-4.04zm27.99 18.87V29.75c0-1.25-.53-1.87-1.87-1.87-2.147.252-4.22.932-6.1 2v16.19h-5.86V22.69h4.46l.58 2c2.916-1.46 6.104-2.293 9.36-2.45 1.852-.175 3.616.823 4.42 2.5 2.922-1.495 6.13-2.348 9.41-2.5 3.89 0 5.28 2.74 5.28 6.91v16.92h-5.86V29.75c0-1.25-.53-1.87-1.87-1.87-2.15.234-4.23.915-6.1 2v16.19h-5.85zm41.81 0h-4.8l-.43-1.58c-2.084 1.352-4.516 2.068-7 2.06-4.27 0-6.1-2.93-6.1-7 0-4.75 2.06-6.58 6.82-6.58H177v-2.41c0-2.59-.72-3.5-4.46-3.5-2.18.024-4.35.265-6.48.72l-.72-4.46c2.606-.72 5.296-1.09 8-1.1 7.34 0 9.5 2.59 9.5 8.45l.05 15.4zM177 37.24h-4.32c-1.92 0-2.45.53-2.45 2.3 0 1.77.53 2.35 2.35 2.35 1.55-.02 3.07-.434 4.42-1.2v-3.45zm9.48-6.77c0-5.18 2.3-8.26 7.73-8.26 2.097.02 4.187.244 6.24.67v-9.74l5.86-.82v33.75h-4.66l-.58-2c-2.133 1.595-4.726 2.454-7.39 2.45-4.7 0-7.2-2.79-7.2-8.11v-7.94zm14-2.64c-1.702-.38-3.437-.588-5.18-.62-2.11 0-2.93 1-2.93 3.12v8.26c0 1.92.72 3 2.88 3 1.937-.07 3.787-.816 5.23-2.11V27.83z"></path>
  </g>
</svg>

  </div>

  <ul class="nav sidebar-nav">
    <li><a href="/intro/index.html">Intro</a></li>
    <li><a href="/guides/index.html">Guides</a></li>
    <li><a href="/docs/index.html">Docs</a></li>
    <li><a href="/api/index.html">API</a></li>
    <li><a href="/community.html">Community</a></li>
    <li><a href="https://www.hashicorp.com/products/nomad/?utm_source=oss&utm_medium=header-nav&utm_campaign=nomad">Enterprise</a></li>
    <li><a href="/security.html">Security</a></li>
    <li><a href="/assets/files/press-kit.zip">Press Kit</a></li>
  </ul>

  <div class="divider"></div>

  <ul class="external nav sidebar-nav">
    <li>
      <a href="/downloads.html">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 28 28" enable-background="new 0 0 28 28" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
  <path d="M28 0H0v28h28V0zM13.8 22.9L7 17.3l2-2.4 3.2 2.6V7h3.2v10.5l3.2-2.6 2 2.4L13.8 22.9z"></path>
</svg>
 Download
      </a>
    </li>
    <li>
      <a href="https://github.com/hashicorp/nomad">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 28 28" enable-background="new 0 0 28 28" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
  <path d="M28 0H0v28h11.4c0 0 0-1.3 0-2.4C7.7 26.4 7 23.9 7 23.9 6.4 22.4 5.5 22 5.5 22c-1.2-0.8 0.1-0.8 0.1-0.8 1.3 0.1 2 1.4 2 1.4 1.2 2 3 1.4 3.8 1.1 0.1-0.8 0.5-1.4 0.9-1.8 -2.9-0.3-6-1.5-6-6.5 0-1.4 0.5-2.6 1.3-3.5C7.5 11.5 7 10.2 7.8 8.4c0 0 1.1-0.4 3.6 1.3 1-0.3 2.2-0.4 3.3-0.4 1.1 0 2.2 0.2 3.3 0.4 2.5-1.7 3.6-1.3 3.6-1.3 0.7 1.8 0.3 3.1 0.1 3.5 0.8 0.9 1.3 2.1 1.3 3.5 0 5-3.1 6.1-6 6.5 0.5 0.4 0.9 1.2 0.9 2.4 0 1.8 0 3.7 0 3.7H28V0z"></path>
</svg>
 GitHub
      </a>
    </li>
  </ul>
</aside>


    <div class="container">
  <div class="row">
    <div id="docs-sidebar" class="col-sm-4 col-md-3 col-xs-12 hidden-print" role="complementary">
          <ul class="nav docs-sidenav">
      <li>
        <a href="/docs/install/index.html">Installing Nomad</a>
      </li>

      <li>
        <a href="/docs/runtime/index.html">Runtime</a>
        <ul class="nav">
          <li>
            <a href="/docs/runtime/environment.html">Environment</a>
          </li>
          <li>
            <a href="/docs/runtime/interpolation.html">Interpolation</a>
          </li>
          <li>
            <a href="/docs/runtime/schedulers.html">Schedulers</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="/docs/job-specification/index.html">Job Specification</a>
        <ul class="nav">
          <li>
            <a href="/docs/job-specification/artifact.html">artifact</a>
          </li>
          <li>
            <a href="/docs/job-specification/check_restart.html">check_restart</a>
          </li>
          <li>
            <a href="/docs/job-specification/constraint.html">constraint</a>
          </li>
          <li>
            <a href="/docs/job-specification/dispatch_payload.html">dispatch_payload</a>
          </li>
          <li>
            <a href="/docs/job-specification/env.html">env</a>
          </li>
          <li>
            <a href="/docs/job-specification/ephemeral_disk.html">ephemeral_disk</a>
          </li>
          <li>
            <a href="/docs/job-specification/group.html">group</a>
          </li>
          <li>
            <a href="/docs/job-specification/job.html">job</a>
          </li>
          <li>
            <a href="/docs/job-specification/logs.html">logs</a>
          </li>
          <li>
            <a href="/docs/job-specification/meta.html">meta</a>
          </li>
          <li>
            <a href="/docs/job-specification/migrate.html">migrate</a>
          </li>
          <li>
            <a href="/docs/job-specification/network.html">network</a>
          </li>
          <li>
            <a href="/docs/job-specification/parameterized.html">parameterized</a>
          </li>
          <li>
            <a href="/docs/job-specification/periodic.html">periodic</a>
          </li>
          <li>
            <a href="/docs/job-specification/reschedule.html">reschedule</a>
          </li>
          <li>
            <a href="/docs/job-specification/resources.html">resources</a>
          </li>
          <li>
            <a href="/docs/job-specification/restart.html">restart</a>
          </li>
          <li>
            <a href="/docs/job-specification/service.html">service</a>
          </li>
          <li>
            <a href="/docs/job-specification/task.html">task</a>
          </li>
          <li>
            <a href="/docs/job-specification/template.html">template</a>
          </li>
          <li>
            <a href="/docs/job-specification/update.html">update</a>
          </li>
          <li>
            <a href="/docs/job-specification/vault.html">vault</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="/docs/service-discovery/index.html">Service Discovery</a>
      </li>

      <li class="active">
        <a href="/docs/vault-integration/index.html">Vault Integration</a>
      </li>

      <li>
        <a href="/docs/drivers/index.html">Drivers</a>
        <ul class="nav">
          <li>
            <a href="/docs/drivers/docker.html">Docker</a>
          </li>

          <li>
            <a href="/docs/drivers/exec.html">Isolated Fork/Exec</a>
          </li>

          <li>
            <a href="/docs/drivers/java.html">Java</a>
          </li>

          <li>
            <a href="/docs/drivers/lxc.html">LXC</a>
          </li>

          <li>
            <a href="/docs/drivers/qemu.html">Qemu</a>
          </li>

          <li>
            <a href="/docs/drivers/raw_exec.html">Raw Fork/Exec</a>
          </li>


          <li>
            <a href="/docs/drivers/rkt.html">Rkt</a>
          </li>

          <li>
            <a href="/docs/drivers/custom.html">Custom</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="/docs/commands/index.html">Commands (CLI)</a>
        <ul class="nav">
          <li>
            <a href="/docs/commands/acl.html">acl</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/acl/bootstrap.html">bootstrap</a>
              </li>
              <li>
                <a href="/docs/commands/acl/policy-apply.html">policy apply</a>
              </li>
              <li>
                <a href="/docs/commands/acl/policy-delete.html">policy delete</a>
              </li>
              <li>
                <a href="/docs/commands/acl/policy-info.html">policy info</a>
              </li>
              <li>
                <a href="/docs/commands/acl/policy-list.html">policy list</a>
              </li>
              <li>
                <a href="/docs/commands/acl/token-create.html">token create</a>
              </li>
              <li>
                <a href="/docs/commands/acl/token-delete.html">token delete</a>
              </li>
              <li>
                <a href="/docs/commands/acl/token-info.html">token info</a>
              </li>
              <li>
                <a href="/docs/commands/acl/token-self.html">token self</a>
              </li>
              <li>
                <a href="/docs/commands/acl/token-update.html">token update</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/agent.html">agent</a>
          </li>
          <li>
            <a href="/docs/commands/agent-info.html">agent-info</a>
          </li>
          <li>
            <a href="/docs/commands/alloc.html">alloc</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/alloc/fs.html">fs</a>
              </li>
              <li>
                <a href="/docs/commands/alloc/logs.html">logs</a>
              </li>
              <li>
                <a href="/docs/commands/alloc/status.html">status</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/deployment.html">deployment</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/deployment/fail.html">fail</a>
              </li>
              <li>
                <a href="/docs/commands/deployment/list.html">list</a>
              </li>
              <li>
                <a href="/docs/commands/deployment/pause.html">pause</a>
              </li>
              <li>
                <a href="/docs/commands/deployment/promote.html">promote</a>
              </li>
              <li>
                <a href="/docs/commands/deployment/resume.html">resume</a>
              </li>
              <li>
                <a href="/docs/commands/deployment/status.html">status</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/eval-status.html">eval status</a>
          </li>
          <li>
            <a href="/docs/commands/job.html">job</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/job/deployments.html">deployments</a>
              </li>
              <li>
                <a href="/docs/commands/job/dispatch.html">dispatch</a>
              </li>
              <li>
                <a href="/docs/commands/job/eval.html">eval</a>
              </li>
              <li>
                <a href="/docs/commands/job/history.html">history</a>
              </li>
              <li>
                <a href="/docs/commands/job/init.html">init</a>
              </li>
              <li>
                <a href="/docs/commands/job/inspect.html">inspect</a>
              </li>
              <li>
                <a href="/docs/commands/job/plan.html">plan</a>
              </li>
              <li>
                <a href="/docs/commands/job/promote.html">promote</a>
              </li>
              <li>
                <a href="/docs/commands/job/revert.html">revert</a>
              </li>
              <li>
                <a href="/docs/commands/job/run.html">run</a>
              </li>
              <li>
                <a href="/docs/commands/job/status.html">status</a>
              </li>
              <li>
                <a href="/docs/commands/job/stop.html">stop</a>
              </li>
              <li>
                <a href="/docs/commands/job/validate.html">validate</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/namespace.html">namespace</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/namespace/apply.html">apply</a>
              </li>
              <li>
                <a href="/docs/commands/namespace/delete.html">delete</a>
              </li>
              <li>
                <a href="/docs/commands/namespace/inspect.html">inspect</a>
              </li>
              <li>
                <a href="/docs/commands/namespace/list.html">list</a>
              </li>
              <li>
                <a href="/docs/commands/namespace/status.html">status</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/node.html">node</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/node/config.html">config</a>
              </li>
              <li>
                <a href="/docs/commands/node/drain.html">drain</a>
              </li>
              <li>
                <a href="/docs/commands/node/eligibility.html">eligibility</a>
              </li>
              <li>
                <a href="/docs/commands/node/status.html">status</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/operator.html">operator</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/operator/autopilot-get-config.html">autopilot get-config</a>
              </li>
              <li>
                <a href="/docs/commands/operator/autopilot-set-config.html">autopilot set-config</a>
              </li>
              <li>
                <a href="/docs/commands/operator/keygen.html">keygen</a>
              </li>
              <li>
                <a href="/docs/commands/operator/keyring.html">keyring</a>
              </li>
              <li>
                <a href="/docs/commands/operator/raft-list-peers.html">raft list-peers</a>
              </li>
              <li>
                <a href="/docs/commands/operator/raft-remove-peer.html">raft remove-peer</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/quota.html">quota</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/quota/apply.html">apply</a>
              </li>
              <li>
                <a href="/docs/commands/quota/delete.html">delete</a>
              </li>
              <li>
                <a href="/docs/commands/quota/init.html">init</a>
              </li>
              <li>
                <a href="/docs/commands/quota/inspect.html">inspect</a>
              </li>
              <li>
                <a href="/docs/commands/quota/list.html">list</a>
              </li>
              <li>
                <a href="/docs/commands/quota/status.html">status</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/sentinel.html">sentinel</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/sentinel/apply.html">apply</a>
              </li>
              <li>
                <a href="/docs/commands/sentinel/delete.html">delete</a>
              </li>
              <li>
                <a href="/docs/commands/sentinel/list.html">list</a>
              </li>
              <li>
                <a href="/docs/commands/sentinel/read.html">read</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/server.html">server</a>
            <ul class="nav">
              <li>
                <a href="/docs/commands/server/force-leave.html">force-leave</a>
              </li>
              <li>
                <a href="/docs/commands/server/join.html">join</a>
              </li>
              <li>
                <a href="/docs/commands/server/members.html">members</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/docs/commands/status.html">status</a>
          </li>
          <li>
            <a href="/docs/commands/ui.html">ui</a>
          </li>
          <li>
            <a href="/docs/commands/version.html">version</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="/docs/agent/index.html">Nomad Agent</a>

        <ul class="nav">
          <li >
            <a href="/docs/agent/cloud_auto_join.html">Cloud Auto-join</a>
          </li>
          <li>
            <a href="/docs/agent/configuration/index.html">Configuration</a>
            <ul class="nav">
              <li >
                <a href="/docs/agent/configuration/acl.html">acl</a>
              </li>
              <li >
                <a href="/docs/agent/configuration/autopilot.html">autopilot</a>
              </li>
              <li >
                <a href="/docs/agent/configuration/client.html">client</a>
              </li>
              <li >
                <a href="/docs/agent/configuration/consul.html">consul</a>
              </li>
              <li >
                <a href="/docs/agent/configuration/sentinel.html">sentinel</a>
              </li>
              <li >
                <a href="/docs/agent/configuration/server.html">server</a>
              </li>
              <li >
                <a href="/docs/agent/configuration/server_join.html">server_join</a>
              </li>
              <li >
                <a href="/docs/agent/configuration/telemetry.html">telemetry</a>
              </li>
              <li >
                <a href="/docs/agent/configuration/tls.html">tls</a>
              </li>
              <li >
                <a href="/docs/agent/configuration/vault.html">vault</a>
              </li>
            </ul>
          </li>

          <li>
            <a href="/docs/agent/encryption.html">Encryption</a>
          </li>
          <li>
            <a href="/docs/agent/telemetry.html">Telemetry</a>
          </li>
        </ul>
      </li>

      <hr>

      <li>
        <a href="/docs/internals/index.html">Internals</a>
        <ul class="nav">
          <li>
            <a href="/docs/internals/architecture.html">Architecture</a>
          </li>

          <li>
            <a href="/docs/internals/consensus.html">Consensus Protocol</a>
          </li>

          <li>
            <a href="/docs/internals/gossip.html">Gossip Protocol</a>
          </li>

          <li>
            <a href="/docs/internals/scheduling.html">Scheduling</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="/docs/upgrade/index.html">Upgrading</a>
        <ul class="nav">
          <li>
            <a href="/docs/upgrade/index.html">Upgrading Nomad</a>
          </li>
          <li>
            <a href="/docs/upgrade/upgrade-specific.html">Specific Version Details</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="/docs/faq.html">FAQ</a>
      </li>

      <hr>

      <li>
        <a href="/docs/enterprise/index.html">Nomad Enterprise</a>
        <ul class="nav">
          <li>
            <a href="/docs/enterprise/namespaces/index.html">Namespaces</a>
          </li>
          <li>
            <a href="/docs/enterprise/quotas/index.html">Resource Quotas</a>
          </li>
          <li>
            <a href="/docs/enterprise/sentinel/index.html">Sentinel Policies</a>
          </li>
          <li>
            <a href="/docs/enterprise/autopilot/index.html">Advanced Autopilot</a>
          </li>
        </ul>
      </li>

    </ul>

    </div>

    <div id="inner" class="col-sm-8 col-md-9 col-xs-12" role="main">
      
  <h1 id="vault-integration">
  <a name="vault-integration" class="anchor" href="#vault-integration">&raquo;</a>
  Vault Integration
</h1>
<p>Many workloads require access to tokens, passwords, certificates, API keys, and
other secrets. To enable secure, auditable and easy access to your secrets,
Nomad integrates with HashiCorp&#39;s <a href="https://www.vaultproject.io/" title="Vault by HashiCorp">Vault</a>. Nomad servers and clients
coordinate with Vault to derive a Vault token that has access to only the Vault
policies the tasks needs. Nomad clients make the token available to the task and
handle the tokens renewal. Further, Nomad&#39;s <a href="/docs/job-specification/template.html" title="Nomad template Job Specification"><code>template</code> block</a> can
retrieve secrets from Vault making it easier than ever to secure your
infrastructure.</p>
<p>Note that in order to use Vault with Nomad, you will need to configure and
install Vault separately from Nomad. Nomad does not run Vault for you.</p>
<h2 id="vault-configuration">
  <a name="vault-configuration" class="anchor" href="#vault-configuration">&raquo;</a>
  Vault Configuration
</h2>
<p>To use the Vault integration, Nomad servers must be provided a Vault token. This
token can either be a root token or a periodic token with permissions to create
from a token role. The root token is the easiest way to get started, but we
recommend a token role based token for production installations. Nomad servers
will renew the token automatically. <strong>Note that the Nomad clients do not need to 
be provided with a Vault token.</strong></p>
<h3 id="root-token-integration">
  <a name="root-token-integration" class="anchor" href="#root-token-integration">&raquo;</a>
  Root Token Integration
</h3>
<p>If Nomad is given a <a href="https://www.vaultproject.io/docs/concepts/tokens.html#root-tokens">root
token</a>, no
further configuration is needed as Nomad can derive a token for jobs using any
Vault policies.</p>
<h3 id="token-role-based-integration">
  <a name="token-role-based-integration" class="anchor" href="#token-role-based-integration">&raquo;</a>
  Token Role based Integration
</h3>
<p>Vault&#39;s <a href="https://www.vaultproject.io/docs/auth/token.html" title="Vault Authentication Backend">Token Authentication Backend</a> supports a concept called &quot;roles&quot;.
Token roles allow policies to be grouped together and token creation to be
delegated to a trusted service such as Nomad. By creating a token role, the set
of policies that tasks managed by Nomad can access may be limited compared to
giving Nomad a root token. Token roles allow both white-list and blacklist
management of policies accessible to the role.</p>
<p>To configure Nomad and Vault to create tokens against a role, the following must
occur:</p>

<ol>
<li><p>Create a &quot;nomad-server&quot; policy used by Nomad to create and manage tokens.</p>
</li>
<li><p>Create a Vault token role with the configuration described below.</p>
</li>
<li><p>Configure Nomad to use the created token role.</p>
</li>
<li><p>Give Nomad servers a periodic token with the &quot;nomad-server&quot; policy created
 above.</p>
</li>
</ol>
<h4 id="required-vault-policies">
  <a name="required-vault-policies" class="anchor" href="#required-vault-policies">&raquo;</a>
  Required Vault Policies
</h4>
<p>The token Nomad receives must have the capabilities listed below. An explanation
for the use of each capability is given.</p>
<div class="highlight"><pre class="highlight hcl"><code><span class="c1"># Allow creating tokens under "nomad-cluster" token role. The token role name</span>
<span class="c1"># should be updated if "nomad-cluster" is not used.</span>
<span class="n">path</span> <span class="s2">"auth/token/create/nomad-cluster"</span> <span class="p">{</span>
  <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"update"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Allow looking up "nomad-cluster" token role. The token role name should be</span>
<span class="c1"># updated if "nomad-cluster" is not used.</span>
<span class="n">path</span> <span class="s2">"auth/token/roles/nomad-cluster"</span> <span class="p">{</span>
  <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"read"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Allow looking up the token passed to Nomad to validate # the token has the</span>
<span class="c1"># proper capabilities. This is provided by the "default" policy.</span>
<span class="n">path</span> <span class="s2">"auth/token/lookup-self"</span> <span class="p">{</span>
  <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"read"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Allow looking up incoming tokens to validate they have permissions to access</span>
<span class="c1"># the tokens they are requesting. This is only required if</span>
<span class="c1"># `allow_unauthenticated` is set to false.</span>
<span class="n">path</span> <span class="s2">"auth/token/lookup"</span> <span class="p">{</span>
  <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"update"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Allow revoking tokens that should no longer exist. This allows revoking</span>
<span class="c1"># tokens for dead tasks.</span>
<span class="n">path</span> <span class="s2">"auth/token/revoke-accessor"</span> <span class="p">{</span>
  <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"update"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Allow checking the capabilities of our own token. This is used to validate the</span>
<span class="c1"># token upon startup.</span>
<span class="n">path</span> <span class="s2">"sys/capabilities-self"</span> <span class="p">{</span>
  <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"update"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Allow our own token to be renewed.</span>
<span class="n">path</span> <span class="s2">"auth/token/renew-self"</span> <span class="p">{</span>
  <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"update"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div><p>The above <a href="/data/vault/nomad-server-policy.hcl"><code>nomad-server</code> policy</a> is
available for download. Below is an example of writing this policy to Vault:</p>
<div class="highlight"><pre class="highlight plaintext"><code># Download the policy
$ curl https://nomadproject.io/data/vault/nomad-server-policy.hcl -O -s -L

# Write the policy to Vault
$ vault policy write nomad-server nomad-server-policy.hcl
</code></pre></div><h4 id="vault-token-role-configuration">
  <a name="vault-token-role-configuration" class="anchor" href="#vault-token-role-configuration">&raquo;</a>
  Vault Token Role Configuration
</h4>
<p>A Vault token role must be created for use by Nomad. The token role can be used
to manage what Vault policies are accessible by jobs submitted to Nomad. The
policies can be managed as a whitelist by using <code>allowed_policies</code> in the token
role definition or as a blacklist by using <code>disallowed_policies</code>.</p>
<p>If using <code>allowed_policies</code>, tasks may only request Vault policies that are in
the list. If <code>disallowed_policies</code> is used, task may request any policy that is
not in the <code>disallowed_policies</code> list. There are trade-offs to both approaches
but generally it is easier to use the blacklist approach and add policies that
you would not like tasks to have access to into the <code>disallowed_policies</code> list.</p>
<p>An example token role definition is given below:</p>
<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"disallowed_policies"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nomad-server"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"explicit_max_ttl"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nomad-cluster"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"orphan"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"period"</span><span class="p">:</span><span class="w"> </span><span class="mi">259200</span><span class="p">,</span><span class="w">
  </span><span class="s2">"renewable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h5 id="token-role-requirements">
  <a name="token-role-requirements" class="anchor" href="#token-role-requirements">&raquo;</a>
  Token Role Requirements
</h5>
<p>Nomad checks that token role has an appropriate configuration for use by the
cluster. Fields that are checked are documented below as well as descriptions of
the important fields. See Vault&#39;s <a href="https://www.vaultproject.io/docs/auth/token.html" title="Vault Authentication Backend">Token Authentication Backend</a>
documentation for all possible fields and more complete documentation.</p>

<ul>
<li><p><a name="allowed_policies" /><a href="#allowed_policies"><code>allowed_policies</code></a> - Specifies the list of allowed policies as a
comma-separated string. This list should contain all policies that jobs running
under Nomad should have access to.</p>
</li>
<li><p><a name="disallowed_policies" /><a href="#disallowed_policies"><code>disallowed_policies</code></a> - Specifies the list of disallowed policies as a
 comma-separated string. This list should contain all policies that jobs running
 under Nomad should <strong>not</strong> have access to. The policy created above that
 grants Nomad the ability to generate tokens from the token role should be
 included in list of disallowed policies. This prevents tokens created by
 Nomad from generating new tokens with different policies than those granted
 by Nomad.</p>
<p>A regression occurred in Vault 0.6.4 when validating token creation using a
 token role with <code>disallowed_policies</code> such that it is not usable with
 Nomad. This will be remedied in 0.6.5 and does not effect earlier versions
 of Vault.</p>
</li>
<li><p><a name="explicit_max_ttl" /><a href="#explicit_max_ttl"><code>explicit_max_ttl</code></a> - Specifies the max TTL of a token. <strong>Must be set to <code>0</code></strong> to
allow periodic tokens.</p>
</li>
<li><p><a name="name" /><a href="#name"><code>name</code></a> - Specifies the name of the policy. We recommend using the name
<code>nomad-cluster</code>. If a different name is chosen, replace the token role in the
above policy.</p>
</li>
<li><p><a name="orphan" /><a href="#orphan"><code>orphan</code></a> - Specifies whether tokens created against this token role will be
orphaned and have no parents. Nomad does not enforce the value of this field
but understanding the implications of each value is important.</p>
<p>If set to false, all tokens will be revoked when the Vault token given to
Nomad expires. This makes it easy to revoke all tokens generated by Nomad but
forces all Nomad servers to use the same Vault token, even through upgrades of
Nomad servers. If the Vault token that was given to Nomad and used to generate
a tasks token expires, the token used by the task will also be revoked which
is not ideal.</p>
<p>When set to true, the tokens generated for tasks will not be revoked when
Nomad&#39;s token is revoked. However Nomad will still revoke tokens when the
allocation is no longer running, minimizing the lifetime of any task&#39;s token.
With orphaned enabled, each Nomad server may also use a unique Vault token,
making bootstrapping and upgrading simpler. As such, <strong>setting <code>orphan = true</code>
is the recommended setting</strong>.</p>
</li>
<li><p><a name="period" /><a href="#period"><code>period</code></a> - Specifies the length the TTL is extended by each renewal in
seconds. It is suggested to set this value on the order of magnitude of 3 days
(259200 seconds) to avoid a large renewal request rate to Vault. <strong>Must be set
to a positive value</strong>.</p>
</li>
<li><p><a name="renewable" /><a href="#renewable"><code>renewable</code></a> - Specifies whether created tokens are renewable. <strong>Must be set to
<code>true</code></strong>. This allows Nomad to renew tokens for tasks.</p>
</li>
</ul>
<p>The above <a href="/data/vault/nomad-cluster-role.json"><code>nomad-cluster</code> token role</a> is
available for download. Below is an example of writing this role to Vault:</p>
<div class="highlight"><pre class="highlight plaintext"><code># Download the token role
$ curl https://nomadproject.io/data/vault/nomad-cluster-role.json -O -s -L

# Create the token role with Vault
$ vault write /auth/token/roles/nomad-cluster @nomad-cluster-role.json
</code></pre></div><h4 id="example-configuration">
  <a name="example-configuration" class="anchor" href="#example-configuration">&raquo;</a>
  Example Configuration
</h4>
<p>To make getting started easy, the basic <a href="/data/vault/nomad-server-policy.hcl"><code>nomad-server</code>
policy</a> and
<a href="/data/vault/nomad-cluster-role.json"><code>nomad-cluster</code> role</a> described above are
available for download.</p>
<p>The below example assumes Vault is accessible, unsealed and the operator has
appropriate permissions.</p>
<div class="highlight"><pre class="highlight shell"><code><span class="c"># Download the policy and token role</span>
<span class="nv">$ </span>curl https://nomadproject.io/data/vault/nomad-server-policy.hcl <span class="nt">-O</span> <span class="nt">-s</span> <span class="nt">-L</span>
<span class="nv">$ </span>curl https://nomadproject.io/data/vault/nomad-cluster-role.json <span class="nt">-O</span> <span class="nt">-s</span> <span class="nt">-L</span>

<span class="c"># Write the policy to Vault</span>
<span class="nv">$ </span>vault policy write nomad-server nomad-server-policy.hcl

<span class="c"># Create the token role with Vault</span>
<span class="nv">$ </span>vault write /auth/token/roles/nomad-cluster @nomad-cluster-role.json
</code></pre></div><h4 id="retrieving-the-token-role-based-token">
  <a name="retrieving-the-token-role-based-token" class="anchor" href="#retrieving-the-token-role-based-token">&raquo;</a>
  Retrieving the Token Role based Token
</h4>
<p>After the token role is created, a token suitable for the Nomad servers may be
retrieved by issuing the following Vault command:</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ vault token create -policy nomad-server -period 72h -orphan
Key             Value
---             -----
token           f02f01c2-c0d1-7cb7-6b88-8a14fada58c0
token_accessor  8cb7fcb3-9a4f-6fbf-0efc-83092bb0cb1c
token_duration  259200s
token_renewable true
token_policies  [default nomad-server]
</code></pre></div><p>The <code>-orphan</code> flag is included when generating the Nomad server token above to
prevent revocation of the token when its parent expires. Vault typically
creates tokens with a parent-child relationship. When an ancestor token is
revoked, all of its descendant tokens and their associated leases are revoked
as well.</p>
<p>When generating Nomad&#39;s Vault token, we need to ensure that revocation of the
parent token does not revoke Nomad&#39;s token. To prevent this behavior we
specify the <code>-orphan</code> flag when we create the Nomad&#39;s Vault token. All
other tokens generated by Nomad for jobs will be generated using the policy
default of <code>orphan = false</code>.</p>
<p>More information about creating orphan tokens can be found in
<a href="https://www.vaultproject.io/docs/concepts/tokens.html#token-hierarchies-and-orphan-tokens" title="Vault Tokens - Token Hierarchies and Orphan Tokens">Vault&#39;s Token Hierarchies and Orphan Tokens documentation</a>.</p>
<p>The token can then be set in the server configuration&#39;s
<a href="/docs/agent/configuration/vault.html" title="Nomad Vault Configuration Block"><code>vault</code> stanza</a>, as a command-line flag, or via an environment
variable.</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ VAULT_TOKEN=f02f01c2-c0d1-7cb7-6b88-8a14fada58c0 nomad agent -config /path/to/config
</code></pre></div><p>An example of what may be contained in the configuration is shown below. For
complete documentation please see the <a href="/docs/agent/configuration/vault.html" title="Nomad Vault Configuration Block">Nomad agent Vault integration</a>
configuration.</p>
<div class="highlight"><pre class="highlight hcl"><code><span class="n">vault</span> <span class="p">{</span>
  <span class="n">enabled</span>          <span class="o">=</span> <span class="kp">true</span>
  <span class="n">ca_path</span>          <span class="o">=</span> <span class="s2">"/etc/certs/ca"</span>
  <span class="n">cert_file</span>        <span class="o">=</span> <span class="s2">"/var/certs/vault.crt"</span>
  <span class="n">key_file</span>         <span class="o">=</span> <span class="s2">"/var/certs/vault.key"</span>
  <span class="n">address</span>          <span class="o">=</span> <span class="s2">"https://vault.service.consul:8200"</span>
  <span class="n">create_from_role</span> <span class="o">=</span> <span class="s2">"nomad-cluster"</span>
<span class="p">}</span>
</code></pre></div><h2 id="agent-configuration">
  <a name="agent-configuration" class="anchor" href="#agent-configuration">&raquo;</a>
  Agent Configuration
</h2>
<p>To enable Vault integration, please see the <a href="/docs/agent/configuration/vault.html" title="Nomad Vault Configuration Block">Nomad agent Vault
integration</a> configuration.</p>
<h2 id="vault-definition-syntax">
  <a name="vault-definition-syntax" class="anchor" href="#vault-definition-syntax">&raquo;</a>
  Vault Definition Syntax
</h2>
<p>To configure a job to retrieve Vault tokens, please see the <a href="/docs/job-specification/vault.html" title="Nomad Vault Job Specification"><code>vault</code> job
specification documentation</a>.</p>
<h2 id="troubleshooting">
  <a name="troubleshooting" class="anchor" href="#troubleshooting">&raquo;</a>
  Troubleshooting
</h2>
<h3 id="invalid-vault-token">
  <a name="invalid-vault-token" class="anchor" href="#invalid-vault-token">&raquo;</a>
  Invalid Vault token
</h3>
<p>Upon startup, Nomad will attempt to connect to the specified Vault server. Nomad
will lookup the passed token and if the token is from a token role, the token
role will be validated. Nomad will not shutdown if given an invalid Vault token,
but will log the reasons the token is invalid and disable Vault integration.</p>
<h3 id="permission-denied-errors">
  <a name="permission-denied-errors" class="anchor" href="#permission-denied-errors">&raquo;</a>
  Permission Denied errors
</h3>
<p>If you are using a Vault version less than 0.7.1 with a Nomad version greater than or equal to 0.6.1, you will need to update your task&#39;s policy (listed in <a href="/docs/job-specification/vault.html" title="Nomad Vault Job Specification">the <code>vault</code> stanza of the job specification</a>) to add the following:</p>
<div class="highlight"><pre class="highlight plaintext"><code>path "sys/leases/renew" {
    capabilities = ["update"]
}
</code></pre></div><p>This is included in Vault&#39;s &quot;default&quot; policy beginning with Vault 0.7.1 and is relied upon by Nomad&#39;s Vault integration beginning with Nomad 0.6.1. If you&#39;re using a newer Nomad version with an older Vault version, your default policy may not automatically include this and you will see &quot;permission denied&quot; errors in your Nomad logs similar to the following:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Code: 403. Errors: 
URL: PUT https://vault:8200/v1/sys/leases/renew 
* permission denied
</code></pre></div><h2 id="assumptions">
  <a name="assumptions" class="anchor" href="#assumptions">&raquo;</a>
  Assumptions
</h2>

<ul>
<li>Vault 0.6.2 or later is needed.
</li>
</ul>


    </div>
  </div>
</div>


    <div id="footer" class="navigation hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <ul class="footer-links nav navbar-nav">
              <li><a href="/intro/index.html">Intro</a></li>
              <li><a href="/guides/index.html">Guides</a></li>
              <li><a href="/docs/index.html">Docs</a></li>
              <li><a href="/api/index.html">API</a></li>
              <li><a href="/resources.html">Resources</a></li>
              <li><a href="https://www.hashicorp.com/products/nomad/?utm_source=oss&utm_medium=header-nav&utm_campaign=nomad">Enterprise</a></li>
              <li><a href="https://demo.nomadproject.io">UI Demo</a></li>
              <li><a href="https://www.hashicorp.com/privacy">Privacy</a></li>
              <li><a href="/security.html">Security</a></li>
              <li><a href="/assets/files/press-kit.zip">Press Kit</a></li>
            </ul>
            <ul class="footer-links nav navbar-nav navbar-right">
              <li><a href="https://github.com/hashicorp/nomad/blob/master/website/source/docs/vault-integration/index.html.md">Edit this page</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Product",
        "name": "Nomad",
        "alternateName": "Nomad by HashiCorp",
        "manufacturer": "HashiCorp",
        "url": "https://www.nomadproject.io",
        "logo": "https://www.nomadproject.io/assets/images/logo-hashicorp-039941e4.svg",
        "sameAs": [
          "https://github.com/hashicorp/nomad"
        ]
      }
    </script>
  </body>
</html>
