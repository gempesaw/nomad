<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Nomad has built-in support for doing blue&#x2F;green and canary deployments to more safely update existing applications and services.">

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon-d0ced218.png">
    <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-194x194-bb8de46a.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/assets/images/favicons/android-chrome-192x192-9f336178.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32-10aa6ba6.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16-330a0dd1.png" sizes="16x16">
    <link rel="manifest" href="/android-manifest.json">
    <link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab-479e3179.svg" color="#25BA81">
    <meta name="apple-mobile-web-app-title" content="HashiCorp Nomad">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="application-name" content="HashiCorp Nomad">
    <meta name="msapplication-config" content="/microsoft-tile.xml" />
    <meta name="msapplication-TileColor" content="#25BA81">
    <meta name="msapplication-TileImage" content="/assets/images/favicons/mstile-144x144-7f37eaf2.png">
    <meta name="theme-color" content="#ffffff">

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@HashiCorp" />
    <meta name="twitter:creator" content="@HashiCorp" />
    <meta property="og:url" content="https://www.nomadproject.io/guides/operating-a-job/update-strategies/blue-green-and-canary-deployments.html" />
    <meta property="og:title" content="Blue/Green & Canary Deployments - Operating a Job - Nomad by HashiCorp" />
    <meta property="og:site_name" content="Nomad by HashiCorp"/>
    <meta property="og:image" content="https://www.nomadproject.io/assets/images/og-image-e0e8d18d.png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="1200"/>
    <meta property="og:description" content="Nomad has built-in support for doing blue&#x2F;green and canary deployments to more safely update existing applications and services." />

    <title>Blue/Green & Canary Deployments - Operating a Job - Nomad by HashiCorp</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://use.typekit.net/wxf7mfi.css">
    <link href="/assets/stylesheets/application-b44b5029.css" rel="stylesheet" />

    <!-- Site scripts -->
    <!--[if lt IE 9]><script src="/assets/javascripts/ie-compat-c141a02d.js" defer="defer"></script><![endif]-->
    <script src="/assets/javascripts/application-4af6ff56.js" defer="defer"></script>


  </head>

  <body id="page-guides-operating-a-job-updating-blue-green-deployments" class="layout-guides page-blue-green-canary-deployments-operating-a-job">

    <svg class="hidden-print" aria-hidden="true" style="position: absolute; width: 0; height: 0;" width="0" height="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
    <symbol id="mega-nav-icon-angle" viewBox="0 0 13 7">
      <polygon points="6.5,6.5 0.7,1.6 1.3,0.8 6.5,5.2 11.7,0.8 12.3,1.6 "/>
    </symbol>
    <symbol id="mega-nav-icon-close" viewBox="0 0 13 15">
      <path vector-effect="non-scaling-stroke" d="M1.1 14L11.9 1M11.9 14L1.1 1"/>
    </symbol>
  </defs>
</svg>
<div class="hidden-print mega-nav-sandbox">
  <div class="mega-nav-banner">
    <div class="container">
      <div class="mega-nav-banner-item">
        <a class="mega-nav-banner-logo" href="https://www.hashicorp.com"><img src="/assets/images/mega-nav/logo-hashicorp-wordmark-bbed0e8a.svg" alt="HashiCorp Logo" /></a>
      </div>
      <div class="mega-nav-banner-item">
        <p class="mega-nav-tagline"><span class="visible-xs text-muted">Learn the</span><span class="hidden-xs text-muted">Learn how Nomad fits into the</span></p>
        <div id="#mega-nav" class="mega-nav">
          <button type="button" id="mega-nav-ctrl" class="mega-nav-ctrl">
            <div class="mega-nav-ctrl-items">
              <img src="/assets/images/mega-nav/logo-hashicorp-a66fda95.svg" alt="HashiCorp Logo" />
              <strong>HashiCorp Suite</strong>
              <span class="mega-nav-icon-outline">
                <svg class="mega-nav-icon mega-nav-icon-angle-right" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#mega-nav-icon-angle"></use></svg><span class="visuallyhidden">Open</span>
              </span>
            </div>
          </button>
          <div id="mega-nav-body-ct" class="mega-nav-body-ct" aria-labelledby="mega-nav-ctrl">
            <div class="mega-nav-body">
              <button type="button" id="mega-nav-close" class="mega-nav-close"><svg class="mega-nav-icon mega-nav-icon-close" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#mega-nav-icon-close"></use></svg><span class="visuallyhidden">Close</span></button>
              <div class="mega-nav-body-header">
                <div class="mega-nav-body-header-item">
                  <h2 class="mega-nav-h1">Provision, Secure, Connect, and&nbsp;Run</h2>
                  <p class="mega-nav-h2">Any infrastructure for any&nbsp;application</p>
                </div>
                <div class="mega-nav-body-header-item">
                  <a href="https://www.hashicorp.com/" class="mega-nav-btn"><img src="/assets/images/mega-nav/logo-hashicorp-a66fda95.svg" alt="HashiCorp Logo" /> Learn the HashiCorp Enterprise&nbsp;Suite <svg class="mega-nav-icon mega-nav-icon-angle-right" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#mega-nav-icon-angle"></use></svg></a>
                </div>
              </div>
              <div class="mega-nav-body-grid">
                <div class="mega-nav-body-grid-item">
                  <h3 class="mega-nav-h3">Provision</h3>
                  <ul class="mega-nav-grid">
                    <li>
                      <a href="https://www.vagrantup.com" class="mega-nav-grid-item mega-nav-grid-item-vagrant">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-vagrant-a7ab5898.svg" alt="Vagrant Logo" />
                        </div>
                        <b>Vagrant</b>
                        <ul>
                          <li><span class="mega-nav-tag">Build</span></li>
                          <li><span class="mega-nav-tag">Test</span></li>
                        </ul>
                      </a>
                    </li>
                    <li>
                      <a href="https://www.packer.io" class="mega-nav-grid-item mega-nav-grid-item-packer">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-packer-cb3b9b94.svg" alt="Packer Logo" />
                        </div>
                        <b>Packer</b>
                        <ul>
                          <li><span class="mega-nav-tag">Package</span></li>
                        </ul>
                      </a>
                    </li>
                    <li>
                      <a href="https://www.terraform.io" class="mega-nav-grid-item mega-nav-grid-item-terraform">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-terraform-ff69eaae.svg" alt="Terraform Logo" />
                        </div>
                        <b>Terraform</b>
                        <ul>
                          <li><span class="mega-nav-tag">Provision</span></li>
                        </ul>
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="mega-nav-body-grid-item">
                  <h3 class="mega-nav-h3">Secure</h3>
                  <ul class="mega-nav-grid">
                    <li>
                      <a href="https://www.vaultproject.io" class="mega-nav-grid-item mega-nav-grid-item-vault">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-vault-0f83e3d2.svg" alt="Vault Logo" />
                        </div>
                        <b>Vault</b>
                        <ul>
                          <li><span class="mega-nav-tag">Secure</span></li>
                        </ul>
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="mega-nav-body-grid-item">
                  <h3 class="mega-nav-h3">Connect</h3>
                  <ul class="mega-nav-grid">
                    <li>
                      <a href="https://www.consul.io" class="mega-nav-grid-item mega-nav-grid-item-consul">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-consul-c77f6844.svg" alt="Consul Logo" />
                        </div>
                        <b>Consul</b>
                        <ul>
                          <li><span class="mega-nav-tag">Connect</span></li>
                        </ul>
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="mega-nav-body-grid-item">
                  <h3 class="mega-nav-h3">Run</h3>
                  <ul class="mega-nav-grid">
                    <li>
                      <a href="https://www.nomadproject.io" class="mega-nav-grid-item mega-nav-grid-item-nomad">
                        <div class="mega-nav-grid-item-img">
                          <img src="/assets/images/mega-nav/logo-nomad-c4c148be.svg" alt="Nomad Logo" />
                        </div>
                        <b>Nomad</b>
                        <ul>
                          <li><span class="mega-nav-tag">Run</span></li>
                        </ul>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="mega-nav-body-footer">
                <p>Seven elements of the modern Application Lifecycle</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


    <div id="header" class="navigation navbar-static-top hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <div class="navbar-header">
              <div class="navbar-brand">
                <a href="/">
                  <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 207 60" class="logo" height="50">
  <g fill="none">
    <path class="top" fill="#25BA81" d="M26.03.01L0 15.05l17.56 10.32 3.56-2.17 8.63 4.82v-10l8.27-4.97v10.02l14.48-8.02v-.04"></path>
    <path class="left" fill="#25BA81" d="M22.75 32.03v9.99l-7.88 5v-20l2.99-1.83L.15 15.05H0v29.96l26.25 15V34.03"></path>
    <path class="right" fill="#1F9967" d="M38.02 23.07v9.95l-6.93 4.01-4.84-3v25.98h.14l26.11-15V15.05l-.49-.01"></path>
    <path class="text" fill="#000" d="M78.49 21.83v24.24h-5.9v-32h8.06l12.14 24.32V14.1h5.9v32h-8.06m22.46.45c-8 0-10.18-4.42-10.18-9.22v-5.9c0-4.8 2.16-9.22 10.18-9.22s10.18 4.42 10.18 9.22v5.91c0 4.79-2.16 9.21-10.18 9.21zm0-19.35c-3.12 0-4.32 1.39-4.32 4v6.29c0 2.64 1.2 4 4.32 4s4.32-1.39 4.32-4v-6.25c0-2.64-1.2-4.04-4.32-4.04zm27.99 18.87V29.75c0-1.25-.53-1.87-1.87-1.87-2.147.252-4.22.932-6.1 2v16.19h-5.86V22.69h4.46l.58 2c2.916-1.46 6.104-2.293 9.36-2.45 1.852-.175 3.616.823 4.42 2.5 2.922-1.495 6.13-2.348 9.41-2.5 3.89 0 5.28 2.74 5.28 6.91v16.92h-5.86V29.75c0-1.25-.53-1.87-1.87-1.87-2.15.234-4.23.915-6.1 2v16.19h-5.85zm41.81 0h-4.8l-.43-1.58c-2.084 1.352-4.516 2.068-7 2.06-4.27 0-6.1-2.93-6.1-7 0-4.75 2.06-6.58 6.82-6.58H177v-2.41c0-2.59-.72-3.5-4.46-3.5-2.18.024-4.35.265-6.48.72l-.72-4.46c2.606-.72 5.296-1.09 8-1.1 7.34 0 9.5 2.59 9.5 8.45l.05 15.4zM177 37.24h-4.32c-1.92 0-2.45.53-2.45 2.3 0 1.77.53 2.35 2.35 2.35 1.55-.02 3.07-.434 4.42-1.2v-3.45zm9.48-6.77c0-5.18 2.3-8.26 7.73-8.26 2.097.02 4.187.244 6.24.67v-9.74l5.86-.82v33.75h-4.66l-.58-2c-2.133 1.595-4.726 2.454-7.39 2.45-4.7 0-7.2-2.79-7.2-8.11v-7.94zm14-2.64c-1.702-.38-3.437-.588-5.18-.62-2.11 0-2.93 1-2.93 3.12v8.26c0 1.92.72 3 2.88 3 1.937-.07 3.787-.816 5.23-2.11V27.83z"></path>
  </g>
</svg>

                </a>
              </div>
              <button class="navbar-toggle" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="buttons hidden-xs">
              <nav class="navigation-links" role="navigation">
                <ul class="main-links nav navbar-nav navbar-right">
                  <li><a href="/intro/index.html">Intro</a></li>
                  <li><a href="/guides/index.html">Guides</a></li>
                  <li><a href="/docs/index.html">Docs</a></li>
                  <li><a href="/api/index.html">API</a></li>
                  <li><a href="/resources.html">Resources</a></li>
                  <li><a href="https://www.hashicorp.com/products/nomad/?utm_source=oss&utm_medium=header-nav&utm_campaign=nomad">Enterprise</a></li>
                  <li><a href="https://demo.nomadproject.io">UI Demo</a></li>
                  <li>
                    <a href="/downloads.html">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 28 28" enable-background="new 0 0 28 28" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
  <path d="M28 0H0v28h28V0zM13.8 22.9L7 17.3l2-2.4 3.2 2.6V7h3.2v10.5l3.2-2.6 2 2.4L13.8 22.9z"></path>
</svg>
 Download
                    </a>
                  </li>
                  <li>
                    <a href="https://github.com/hashicorp/nomad">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 28 28" enable-background="new 0 0 28 28" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
  <path d="M28 0H0v28h11.4c0 0 0-1.3 0-2.4C7.7 26.4 7 23.9 7 23.9 6.4 22.4 5.5 22 5.5 22c-1.2-0.8 0.1-0.8 0.1-0.8 1.3 0.1 2 1.4 2 1.4 1.2 2 3 1.4 3.8 1.1 0.1-0.8 0.5-1.4 0.9-1.8 -2.9-0.3-6-1.5-6-6.5 0-1.4 0.5-2.6 1.3-3.5C7.5 11.5 7 10.2 7.8 8.4c0 0 1.1-0.4 3.6 1.3 1-0.3 2.2-0.4 3.3-0.4 1.1 0 2.2 0.2 3.3 0.4 2.5-1.7 3.6-1.3 3.6-1.3 0.7 1.8 0.3 3.1 0.1 3.5 0.8 0.9 1.3 2.1 1.3 3.5 0 5-3.1 6.1-6 6.5 0.5 0.4 0.9 1.2 0.9 2.4 0 1.8 0 3.7 0 3.7H28V0z"></path>
</svg>
 GitHub
                    </a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar-overlay"></div>

<aside class="sidebar" role="navigation">
  <div class="sidebar-header">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 207 60" height="42">
  <g fill="none">
    <path class="top" fill="#25BA81" d="M26.03.01L0 15.05l17.56 10.32 3.56-2.17 8.63 4.82v-10l8.27-4.97v10.02l14.48-8.02v-.04"></path>
    <path class="left" fill="#25BA81" d="M22.75 32.03v9.99l-7.88 5v-20l2.99-1.83L.15 15.05H0v29.96l26.25 15V34.03"></path>
    <path class="right" fill="#1F9967" d="M38.02 23.07v9.95l-6.93 4.01-4.84-3v25.98h.14l26.11-15V15.05l-.49-.01"></path>
    <path class="text" fill="#000" d="M78.49 21.83v24.24h-5.9v-32h8.06l12.14 24.32V14.1h5.9v32h-8.06m22.46.45c-8 0-10.18-4.42-10.18-9.22v-5.9c0-4.8 2.16-9.22 10.18-9.22s10.18 4.42 10.18 9.22v5.91c0 4.79-2.16 9.21-10.18 9.21zm0-19.35c-3.12 0-4.32 1.39-4.32 4v6.29c0 2.64 1.2 4 4.32 4s4.32-1.39 4.32-4v-6.25c0-2.64-1.2-4.04-4.32-4.04zm27.99 18.87V29.75c0-1.25-.53-1.87-1.87-1.87-2.147.252-4.22.932-6.1 2v16.19h-5.86V22.69h4.46l.58 2c2.916-1.46 6.104-2.293 9.36-2.45 1.852-.175 3.616.823 4.42 2.5 2.922-1.495 6.13-2.348 9.41-2.5 3.89 0 5.28 2.74 5.28 6.91v16.92h-5.86V29.75c0-1.25-.53-1.87-1.87-1.87-2.15.234-4.23.915-6.1 2v16.19h-5.85zm41.81 0h-4.8l-.43-1.58c-2.084 1.352-4.516 2.068-7 2.06-4.27 0-6.1-2.93-6.1-7 0-4.75 2.06-6.58 6.82-6.58H177v-2.41c0-2.59-.72-3.5-4.46-3.5-2.18.024-4.35.265-6.48.72l-.72-4.46c2.606-.72 5.296-1.09 8-1.1 7.34 0 9.5 2.59 9.5 8.45l.05 15.4zM177 37.24h-4.32c-1.92 0-2.45.53-2.45 2.3 0 1.77.53 2.35 2.35 2.35 1.55-.02 3.07-.434 4.42-1.2v-3.45zm9.48-6.77c0-5.18 2.3-8.26 7.73-8.26 2.097.02 4.187.244 6.24.67v-9.74l5.86-.82v33.75h-4.66l-.58-2c-2.133 1.595-4.726 2.454-7.39 2.45-4.7 0-7.2-2.79-7.2-8.11v-7.94zm14-2.64c-1.702-.38-3.437-.588-5.18-.62-2.11 0-2.93 1-2.93 3.12v8.26c0 1.92.72 3 2.88 3 1.937-.07 3.787-.816 5.23-2.11V27.83z"></path>
  </g>
</svg>

  </div>

  <ul class="nav sidebar-nav">
    <li><a href="/intro/index.html">Intro</a></li>
    <li><a href="/guides/index.html">Guides</a></li>
    <li><a href="/docs/index.html">Docs</a></li>
    <li><a href="/api/index.html">API</a></li>
    <li><a href="/community.html">Community</a></li>
    <li><a href="https://www.hashicorp.com/products/nomad/?utm_source=oss&utm_medium=header-nav&utm_campaign=nomad">Enterprise</a></li>
    <li><a href="/security.html">Security</a></li>
    <li><a href="/assets/files/press-kit.zip">Press Kit</a></li>
  </ul>

  <div class="divider"></div>

  <ul class="external nav sidebar-nav">
    <li>
      <a href="/downloads.html">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 28 28" enable-background="new 0 0 28 28" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
  <path d="M28 0H0v28h28V0zM13.8 22.9L7 17.3l2-2.4 3.2 2.6V7h3.2v10.5l3.2-2.6 2 2.4L13.8 22.9z"></path>
</svg>
 Download
      </a>
    </li>
    <li>
      <a href="https://github.com/hashicorp/nomad">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 28 28" enable-background="new 0 0 28 28" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
  <path d="M28 0H0v28h11.4c0 0 0-1.3 0-2.4C7.7 26.4 7 23.9 7 23.9 6.4 22.4 5.5 22 5.5 22c-1.2-0.8 0.1-0.8 0.1-0.8 1.3 0.1 2 1.4 2 1.4 1.2 2 3 1.4 3.8 1.1 0.1-0.8 0.5-1.4 0.9-1.8 -2.9-0.3-6-1.5-6-6.5 0-1.4 0.5-2.6 1.3-3.5C7.5 11.5 7 10.2 7.8 8.4c0 0 1.1-0.4 3.6 1.3 1-0.3 2.2-0.4 3.3-0.4 1.1 0 2.2 0.2 3.3 0.4 2.5-1.7 3.6-1.3 3.6-1.3 0.7 1.8 0.3 3.1 0.1 3.5 0.8 0.9 1.3 2.1 1.3 3.5 0 5-3.1 6.1-6 6.5 0.5 0.4 0.9 1.2 0.9 2.4 0 1.8 0 3.7 0 3.7H28V0z"></path>
</svg>
 GitHub
      </a>
    </li>
  </ul>
</aside>


    <div class="container">
  <div class="row">
    <div id="docs-sidebar" class="col-sm-4 col-md-3 col-xs-12 hidden-print" role="complementary">
            <ul class="nav docs-sidenav">

      <li>
        <a href="/guides/acl.html">ACLs</a>
      </li>

      <li>
        <a href="/guides/spark/spark.html">Apache Spark Integration</a>
        <ul class="nav">
          <li>
            <a href="/guides/spark/pre.html">Getting Started</a>
          </li>
          <li>
            <a href="/guides/spark/submit.html">Submitting Applications</a>
          </li>
          <li>
            <a href="/guides/spark/customizing.html">Customizing Applications</a>
          </li>
          <li>
            <a href="/guides/spark/resource.html">Resource Allocation</a>
          </li>
          <li>
            <a href="/guides/spark/dynamic.html">Dynamic Executors</a>
          </li>
          <li>
            <a href="/guides/spark/hdfs.html">Using HDFS</a>
          </li>
          <li>
            <a href="/guides/spark/monitoring.html">Monitoring Output</a>
          </li>
          <li>
            <a href="/guides/spark/configuration.html">Configuration Properties</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="/guides/cluster/bootstrapping.html">Bootstrapping Clusters</a>
        <ul class="nav">
          <li>
            <a href="/guides/cluster/automatic.html">Automatic</a>
          </li>
          <li>
            <a href="/guides/cluster/autopilot.html">Autopilot</a>
          </li>
          <li>
            <a href="/guides/cluster/manual.html">Manual</a>
          </li>
          <li>
            <a href="/guides/cluster/federation.html">Federation</a>
          </li>
          <li>
            <a href="/guides/cluster/requirements.html">Requirements</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="/guides/node-draining.html">Decommissioning Nodes</a>
      </li>

      <li>
        <a href="/guides/namespaces.html">Namespaces</a>
      </li>

      <li class="active">
        <a href="/guides/operating-a-job/index.html">Operating a Job</a>
        <ul class="nav">
          <li>
            <a href="/guides/operating-a-job/configuring-tasks.html">Configuring Tasks</a>
          </li>
          <li>
            <a href="/guides/operating-a-job/submitting-jobs.html">Submitting Jobs</a>
          </li>
          <li>
            <a href="/guides/operating-a-job/inspecting-state.html">Inspecting State</a>
          </li>
          <li>
            <a href="/guides/operating-a-job/accessing-logs.html">Accessing Logs</a>
          </li>
          <li>
            <a href="/guides/operating-a-job/resource-utilization.html">Resource Utilization</a>
          </li>
          <li class="active">
            <a href="/guides/operating-a-job/update-strategies/index.html">Update Strategies</a>
            <ul class="nav">
              <li>
                <a href="/guides/operating-a-job/update-strategies/rolling-upgrades.html">Rolling Upgrades</a>
              </li>
              <li class="active">
                <a href="/guides/operating-a-job/update-strategies/blue-green-and-canary-deployments.html">Blue/Green &amp; Canary</a>
              </li>
              <li>
                <a href="/guides/operating-a-job/update-strategies/handling-signals.html">Handling Signals</a>
              </li>
            </ul>
          </li>
           <li>
                      <a href="/guides/operating-a-job/failure-handling-strategies/index.html">Failure Recovery Strategies</a>
                      <ul class="nav">
                        <li>
                          <a href="/guides/operating-a-job/failure-handling-strategies/restart.html">Local Restarts</a>
                        </li>
                        <li>
                          <a href="/guides/operating-a-job/failure-handling-strategies/check-restart.html">Check Restarts</a>
                        </li>
                        <li>
                          <a href="/guides/operating-a-job/failure-handling-strategies/reschedule.html">Rescheduling</a>
                        </li>
                      </ul>
                    </li>
        </ul>
      </li>

      <li>
        <a href="/guides/outage.html">Outage Recovery</a>
      </li>

      <li>
        <a href="/guides/quotas.html">Resource Quotas</a>
      </li>

      <li>
        <a href="/guides/securing-nomad.html">Securing Nomad</a>
      </li>

      <li>
        <a href="/guides/sentinel-policy.html">Sentinel Policies</a>
        <ul class="nav">
          <li>
            <a href="/guides/sentinel/job.html">Job Object</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="/guides/ui.html">Web UI</a>
      </li>
    </ul>

    </div>

    <div id="inner" class="col-sm-8 col-md-9 col-xs-12" role="main">

  <h1 id="blue-green-amp-canary-deployments">
  <a name="blue-green-amp-canary-deployments" class="anchor" href="#blue-green-amp-canary-deployments">&raquo;</a>
  Blue/Green &amp; Canary Deployments
</h1>
<p>Sometimes <a href="/guides/operating-a-job/update-strategies/rolling-upgrades.html">rolling
upgrades</a> do not
offer the required flexibility for updating an application in production. Often
organizations prefer to put a &quot;canary&quot; build into production or utilize a
technique known as a &quot;blue/green&quot; deployment to ensure a safe application
rollout to production while minimizing downtime.</p>
<h2 id="blue-green-deployments">
  <a name="blue-green-deployments" class="anchor" href="#blue-green-deployments">&raquo;</a>
  Blue/Green Deployments
</h2>
<p>Blue/Green deployments have several other names including Red/Black or A/B, but
the concept is generally the same. In a blue/green deployment, there are two
application versions. Only one application version is active at a time, except
during the transition phase from one version to the next. The term &quot;active&quot;
tends to mean &quot;receiving traffic&quot; or &quot;in service&quot;.</p>
<p>Imagine a hypothetical API server which has five instances deployed to
production at version 1.3, and we want to safely upgrade to version 1.4. We want
to create five new instances at version 1.4 and in the case that they are
operating correctly we want to promote them and take down the five versions
running 1.3. In the event of failure, we can quickly rollback to 1.3.</p>
<p>To start, we examine our job which is running in production:</p>
<div class="highlight"><pre class="highlight hcl"><code><span class="n">job</span> <span class="s2">"docs"</span> <span class="p">{</span>
  <span class="c1"># ...</span>

  <span class="n">group</span> <span class="s2">"api"</span> <span class="p">{</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="n">update</span> <span class="p">{</span>
      <span class="n">max_parallel</span>     <span class="o">=</span> <span class="mi">1</span>
      <span class="n">canary</span>           <span class="o">=</span> <span class="mi">5</span>
      <span class="n">min_healthy_time</span> <span class="o">=</span> <span class="s2">"30s"</span>
      <span class="n">healthy_deadline</span> <span class="o">=</span> <span class="s2">"10m"</span>
      <span class="n">auto_revert</span>      <span class="o">=</span> <span class="kp">true</span>
    <span class="p">}</span>

    <span class="n">task</span> <span class="s2">"api-server"</span> <span class="p">{</span>
      <span class="n">driver</span> <span class="o">=</span> <span class="s2">"docker"</span>

      <span class="n">config</span> <span class="p">{</span>
        <span class="n">image</span> <span class="o">=</span> <span class="s2">"api-server:1.3"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>We see that it has an <code>update</code> stanza that has the <code>canary</code> equal to the desired
count. This is what allows us to easily model blue/green deployments. When we
change the job to run the &quot;api-server:1.4&quot; image, Nomad will create 5 new
allocations without touching the original &quot;api-server:1.3&quot; allocations. Below we
can see how this works by changing the image to run the new version:</p>
<div class="highlight"><pre class="highlight diff"><code><span class="gu">@@ -2,6 +2,8 @@ job "docs" {
</span>  group "api" {
    task "api-server" {
      config {
<span class="gd">-       image = "api-server:1.3"
</span><span class="gi">+       image = "api-server:1.4"
</span></code></pre></div><p>Next we plan and run these changes:</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ nomad job plan docs.nomad
+/- Job: "docs"
+/- Task Group: "api" (5 canary, 5 ignore)
  +/- Task: "api-server" (forces create/destroy update)
    +/- Config {
      +/- image: "api-server:1.3" =&gt; "api-server:1.4"
        }

Scheduler dry-run:
- All tasks successfully allocated.

Job Modify Index: 7
To submit the job with version verification run:

nomad job run -check-index 7 example.nomad

When running the job with the check-index flag, the job will only be run if the
server side version matches the job modify index returned. If the index has
changed, another user has modified the job and the plan's results are
potentially invalid.

$ nomad job run docs.nomad
# ...
</code></pre></div><p>We can see from the plan output that Nomad is going to create 5 canaries that
are running the &quot;api-server:1.4&quot; image and ignore all the allocations running
the older image. Now if we examine the status of the job we can see that both
the blue (&quot;api-server:1.3&quot;) and green (&quot;api-server:1.4&quot;) set are running.</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ nomad status docs
ID            = docs
Name          = docs
Submit Date   = 07/26/17 19:57:47 UTC
Type          = service
Priority      = 50
Datacenters   = dc1
Status        = running
Periodic      = false
Parameterized = false

Summary
Task Group  Queued  Starting  Running  Failed  Complete  Lost
api         0       0         10       0       0         0

Latest Deployment
ID          = 32a080c1
Status      = running
Description = Deployment is running but requires promotion

Deployed
Task Group  Auto Revert  Promoted  Desired  Canaries  Placed  Healthy  Unhealthy
api         true         false     5        5         5       5        0

Allocations
ID        Node ID   Task Group  Version  Desired  Status   Created At
6d8eec42  087852e2  api         1        run      running  07/26/17 19:57:47 UTC
7051480e  087852e2  api         1        run      running  07/26/17 19:57:47 UTC
36c6610f  087852e2  api         1        run      running  07/26/17 19:57:47 UTC
410ba474  087852e2  api         1        run      running  07/26/17 19:57:47 UTC
85662a7a  087852e2  api         1        run      running  07/26/17 19:57:47 UTC
3ac3fe05  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
4bd51979  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
2998387b  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
35b813ee  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
b53b4289  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
</code></pre></div><p>Now that we have the new set in production, we can route traffic to it and
validate the new job version is working properly. Based on whether the new
version is functioning properly or improperly we will either want to promote or
fail the deployment.</p>
<h3 id="promoting-the-deployment">
  <a name="promoting-the-deployment" class="anchor" href="#promoting-the-deployment">&raquo;</a>
  Promoting the Deployment
</h3>
<p>After deploying the new image along side the old version we have determined it
is functioning properly and we want to transition fully to the new version.
Doing so is as simple as promoting the deployment:</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ nomad deployment promote 32a080c1
==&gt; Monitoring evaluation "61ac2be5"
    Evaluation triggered by job "docs"
    Evaluation within deployment: "32a080c1"
    Evaluation status changed: "pending" -&gt; "complete"
==&gt; Evaluation "61ac2be5" finished with status "complete"
</code></pre></div><p>If we look at the job&#39;s status we see that after promotion, Nomad stopped the
older allocations and is only running the new one. This now completes our
blue/green deployment.</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ nomad status docs
ID            = docs
Name          = docs
Submit Date   = 07/26/17 19:57:47 UTC
Type          = service
Priority      = 50
Datacenters   = dc1
Status        = running
Periodic      = false
Parameterized = false

Summary
Task Group  Queued  Starting  Running  Failed  Complete  Lost
api         0       0         5        0       5         0

Latest Deployment
ID          = 32a080c1
Status      = successful
Description = Deployment completed successfully

Deployed
Task Group  Auto Revert  Promoted  Desired  Canaries  Placed  Healthy  Unhealthy
api         true         true      5        5         5       5        0

Allocations
ID        Node ID   Task Group  Version  Desired  Status    Created At
6d8eec42  087852e2  api         1        run      running   07/26/17 19:57:47 UTC
7051480e  087852e2  api         1        run      running   07/26/17 19:57:47 UTC
36c6610f  087852e2  api         1        run      running   07/26/17 19:57:47 UTC
410ba474  087852e2  api         1        run      running   07/26/17 19:57:47 UTC
85662a7a  087852e2  api         1        run      running   07/26/17 19:57:47 UTC
3ac3fe05  087852e2  api         0        stop     complete  07/26/17 19:53:56 UTC
4bd51979  087852e2  api         0        stop     complete  07/26/17 19:53:56 UTC
2998387b  087852e2  api         0        stop     complete  07/26/17 19:53:56 UTC
35b813ee  087852e2  api         0        stop     complete  07/26/17 19:53:56 UTC
b53b4289  087852e2  api         0        stop     complete  07/26/17 19:53:56 UTC
</code></pre></div><h3 id="failing-the-deployment">
  <a name="failing-the-deployment" class="anchor" href="#failing-the-deployment">&raquo;</a>
  Failing the Deployment
</h3>
<p>After deploying the new image alongside the old version we have determined it
is not functioning properly and we want to roll back to the old version.  Doing
so is as simple as failing the deployment:</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ nomad deployment fail 32a080c1
Deployment "32a080c1-de5a-a4e7-0218-521d8344c328" failed. Auto-reverted to job version 0.

==&gt; Monitoring evaluation "6840f512"
    Evaluation triggered by job "example"
    Evaluation within deployment: "32a080c1"
    Allocation "0ccb732f" modified: node "36e7a123", group "cache"
    Allocation "64d4f282" modified: node "36e7a123", group "cache"
    Allocation "664e33c7" modified: node "36e7a123", group "cache"
    Allocation "a4cb6a4b" modified: node "36e7a123", group "cache"
    Allocation "fdd73bdd" modified: node "36e7a123", group "cache"
    Evaluation status changed: "pending" -&gt; "complete"
==&gt; Evaluation "6840f512" finished with status "complete"
</code></pre></div><p>If we now look at the job&#39;s status we can see that after failing the deployment,
Nomad stopped the new allocations and is only running the old ones and reverted
the working copy of the job back to the original specification running
&quot;api-server:1.3&quot;.</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ nomad status docs
ID            = docs
Name          = docs
Submit Date   = 07/26/17 19:57:47 UTC
Type          = service
Priority      = 50
Datacenters   = dc1
Status        = running
Periodic      = false
Parameterized = false

Summary
Task Group  Queued  Starting  Running  Failed  Complete  Lost
api         0       0         5        0       5         0

Latest Deployment
ID          = 6f3f84b3
Status      = successful
Description = Deployment completed successfully

Deployed
Task Group  Auto Revert  Desired  Placed  Healthy  Unhealthy
cache       true         5        5       5        0

Allocations
ID        Node ID   Task Group  Version  Desired  Status    Created At
27dc2a42  36e7a123  api         1        stop     complete  07/26/17 20:07:31 UTC
5b7d34bb  36e7a123  api         1        stop     complete  07/26/17 20:07:31 UTC
983b487d  36e7a123  api         1        stop     complete  07/26/17 20:07:31 UTC
d1cbf45a  36e7a123  api         1        stop     complete  07/26/17 20:07:31 UTC
d6b46def  36e7a123  api         1        stop     complete  07/26/17 20:07:31 UTC
0ccb732f  36e7a123  api         2        run      running   07/26/17 20:06:29 UTC
64d4f282  36e7a123  api         2        run      running   07/26/17 20:06:29 UTC
664e33c7  36e7a123  api         2        run      running   07/26/17 20:06:29 UTC
a4cb6a4b  36e7a123  api         2        run      running   07/26/17 20:06:29 UTC
fdd73bdd  36e7a123  api         2        run      running   07/26/17 20:06:29 UTC

$ nomad job deployments docs
ID        Job ID   Job Version  Status      Description
6f3f84b3  example  2            successful  Deployment completed successfully
32a080c1  example  1            failed      Deployment marked as failed - rolling back to job version 0
c4c16494  example  0            successful  Deployment completed successfully
</code></pre></div><h2 id="canary-deployments">
  <a name="canary-deployments" class="anchor" href="#canary-deployments">&raquo;</a>
  Canary Deployments
</h2>
<p>Canary updates are a useful way to test a new version of a job before beginning
a rolling upgrade. The <code>update</code> stanza supports setting the number of canaries
the job operator would like Nomad to create when the job changes via the
<code>canary</code> parameter. When the job specification is updated, Nomad creates the
canaries without stopping any allocations from the previous job.</p>
<p>This pattern allows operators to achieve higher confidence in the new job
version because they can route traffic, examine logs, etc, to determine the new
application is performing properly.</p>
<div class="highlight"><pre class="highlight hcl"><code><span class="n">job</span> <span class="s2">"docs"</span> <span class="p">{</span>
  <span class="c1"># ...</span>

  <span class="n">group</span> <span class="s2">"api"</span> <span class="p">{</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="n">update</span> <span class="p">{</span>
      <span class="n">max_parallel</span>     <span class="o">=</span> <span class="mi">1</span>
      <span class="n">canary</span>           <span class="o">=</span> <span class="mi">1</span>
      <span class="n">min_healthy_time</span> <span class="o">=</span> <span class="s2">"30s"</span>
      <span class="n">healthy_deadline</span> <span class="o">=</span> <span class="s2">"10m"</span>
      <span class="n">auto_revert</span>      <span class="o">=</span> <span class="kp">true</span>
    <span class="p">}</span>

    <span class="n">task</span> <span class="s2">"api-server"</span> <span class="p">{</span>
      <span class="n">driver</span> <span class="o">=</span> <span class="s2">"docker"</span>

      <span class="n">config</span> <span class="p">{</span>
        <span class="n">image</span> <span class="o">=</span> <span class="s2">"api-server:1.3"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>In the example above, the <code>update</code> stanza tells Nomad to create a single canary
when the job specification is changed. Below we can see how this works by
changing the image to run the new version:</p>
<div class="highlight"><pre class="highlight diff"><code><span class="gu">@@ -2,6 +2,8 @@ job "docs" {
</span>  group "api" {
    task "api-server" {
      config {
<span class="gd">-       image = "api-server:1.3"
</span><span class="gi">+       image = "api-server:1.4"
</span></code></pre></div><p>Next we plan and run these changes:</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ nomad job plan docs.nomad
+/- Job: "docs"
+/- Task Group: "api" (1 canary, 5 ignore)
  +/- Task: "api-server" (forces create/destroy update)
    +/- Config {
      +/- image: "api-server:1.3" =&gt; "api-server:1.4"
        }

Scheduler dry-run:
- All tasks successfully allocated.

Job Modify Index: 7
To submit the job with version verification run:

nomad job run -check-index 7 example.nomad

When running the job with the check-index flag, the job will only be run if the
server side version matches the job modify index returned. If the index has
changed, another user has modified the job and the plan's results are
potentially invalid.

$ nomad job run docs.nomad
# ...
</code></pre></div><p>We can see from the plan output that Nomad is going to create 1 canary that
will run the &quot;api-server:1.4&quot; image and ignore all the allocations running
the older image. If we inspect the status we see that the canary is running
along side the older version of the job:</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ nomad status docs
ID            = docs
Name          = docs
Submit Date   = 07/26/17 19:57:47 UTC
Type          = service
Priority      = 50
Datacenters   = dc1
Status        = running
Periodic      = false
Parameterized = false

Summary
Task Group  Queued  Starting  Running  Failed  Complete  Lost
api         0       0         6        0       0         0

Latest Deployment
ID          = 32a080c1
Status      = running
Description = Deployment is running but requires promotion

Deployed
Task Group  Auto Revert  Promoted  Desired  Canaries  Placed  Healthy  Unhealthy
api         true         false     5        1         1       1        0

Allocations
ID        Node ID   Task Group  Version  Desired  Status   Created At
85662a7a  087852e2  api         1        run      running  07/26/17 19:57:47 UTC
3ac3fe05  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
4bd51979  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
2998387b  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
35b813ee  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
b53b4289  087852e2  api         0        run      running  07/26/17 19:53:56 UTC
</code></pre></div><p>Now if we promote the canary, this will trigger a rolling update to replace the
remaining allocations running the older image. The rolling update will happen at
a rate of <code>max_parallel</code>, so in this case one allocation at a time:</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ nomad deployment promote 37033151
==&gt; Monitoring evaluation "37033151"
    Evaluation triggered by job "docs"
    Evaluation within deployment: "ed28f6c2"
    Allocation "f5057465" created: node "f6646949", group "cache"
    Allocation "f5057465" status changed: "pending" -&gt; "running"
    Evaluation status changed: "pending" -&gt; "complete"
==&gt; Evaluation "37033151" finished with status "complete"

$ nomad status docs
ID            = docs
Name          = docs
Submit Date   = 07/26/17 20:28:59 UTC
Type          = service
Priority      = 50
Datacenters   = dc1
Status        = running
Periodic      = false
Parameterized = false

Summary
Task Group  Queued  Starting  Running  Failed  Complete  Lost
api         0       0         5        0       2         0

Latest Deployment
ID          = ed28f6c2
Status      = running
Description = Deployment is running

Deployed
Task Group  Auto Revert  Promoted  Desired  Canaries  Placed  Healthy  Unhealthy
api         true         true      5        1         2       1        0

Allocations
ID        Node ID   Task Group  Version  Desired  Status    Created At
f5057465  f6646949  api         1        run      running   07/26/17 20:29:23 UTC
b1c88d20  f6646949  api         1        run      running   07/26/17 20:28:59 UTC
1140bacf  f6646949  api         0        run      running   07/26/17 20:28:37 UTC
1958a34a  f6646949  api         0        run      running   07/26/17 20:28:37 UTC
4bda385a  f6646949  api         0        run      running   07/26/17 20:28:37 UTC
62d96f06  f6646949  api         0        stop     complete  07/26/17 20:28:37 UTC
f58abbb2  f6646949  api         0        stop     complete  07/26/17 20:28:37 UTC
</code></pre></div><p>Alternatively, if the canary was not performing properly, we could abandon the
change using the <code>nomad deployment fail</code> command, similar to the blue/green
example.</p>


    </div>
  </div>
</div>


    <div id="footer" class="navigation hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <ul class="footer-links nav navbar-nav">
              <li><a href="/intro/index.html">Intro</a></li>
              <li><a href="/guides/index.html">Guides</a></li>
              <li><a href="/docs/index.html">Docs</a></li>
              <li><a href="/api/index.html">API</a></li>
              <li><a href="/resources.html">Resources</a></li>
              <li><a href="https://www.hashicorp.com/products/nomad/?utm_source=oss&utm_medium=header-nav&utm_campaign=nomad">Enterprise</a></li>
              <li><a href="https://demo.nomadproject.io">UI Demo</a></li>
              <li><a href="https://www.hashicorp.com/privacy">Privacy</a></li>
              <li><a href="/security.html">Security</a></li>
              <li><a href="/assets/files/press-kit.zip">Press Kit</a></li>
            </ul>
            <ul class="footer-links nav navbar-nav navbar-right">
              <li><a href="https://github.com/hashicorp/nomad/blob/master/website/source/guides/operating-a-job/update-strategies/blue-green-and-canary-deployments.html.md">Edit this page</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Product",
        "name": "Nomad",
        "alternateName": "Nomad by HashiCorp",
        "manufacturer": "HashiCorp",
        "url": "https://www.nomadproject.io",
        "logo": "https://www.nomadproject.io/assets/images/logo-hashicorp-039941e4.svg",
        "sameAs": [
          "https://github.com/hashicorp/nomad"
        ]
      }
    </script>
  </body>
</html>
